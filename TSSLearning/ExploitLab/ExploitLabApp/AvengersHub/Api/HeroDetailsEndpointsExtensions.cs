namespace ExploitLabApp.AccountManagement.Api;

using ExploitLabApp.Heroes.Application;
using System.Net.Mime;
using System.Text;

public static class HeroDetailsEndpointsExtensions
{
  public static void MapHeroDetailsEndpoints(this IEndpointRouteBuilder app)
  {
    app.MapGet("/api/heroes/{heroName}/details", async (IHeroesRepository repo, string heroName) =>
    {
      StringBuilder sb = new StringBuilder();
         
      var heroes = await repo.GetByPatternAsync(heroName);
      foreach (var hero in heroes)
      {        
        sb
        .Append("<h1>")
        .Append(hero.HeroName)
        .AppendLine("</h1>")
        .AppendLine($"<p><strong>Power:</strong> {hero.Power}</p>")
        .AppendLine($"<p><strong>Email:</strong> {hero.Email}</p>");
      }

      return Results.Content(sb.ToString(), MediaTypeNames.Text.Html, Encoding.UTF8);
    });

  }
}
