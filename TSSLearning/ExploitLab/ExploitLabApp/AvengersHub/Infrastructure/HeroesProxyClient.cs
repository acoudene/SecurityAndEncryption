using ExploitLabApp.IdentityProvider.Api;
using ExploitLabApp.AvengersHub.Api;

namespace ExploitLabApp.Heroes.Infrastructure;

public class HeroesProxyClient
{
  private readonly HttpClient _httpClient;

  public HeroesProxyClient(HttpClient httpClient)
  {
    _httpClient = httpClient ?? throw new ArgumentNullException(nameof(httpClient));
  }

  public async Task<HttpResponseMessage> CreateAsync(HeroCreationDto heroCreation)
  {
    return await _httpClient.PostAsJsonAsync<HeroCreationDto>(string.Empty, heroCreation);
  }

  public async Task<List<HeroReadDto>?> SearchAsync(string? searchPattern = null)
  {
    string requestUri = string.IsNullOrWhiteSpace(searchPattern) ? string.Empty : $"?searchPattern={Uri.EscapeDataString(searchPattern)}";
    return await _httpClient.GetFromJsonAsync<List<HeroReadDto>>(requestUri);
  }

  public async Task<string> GetHtmlDetailsAsync(string heroName)
  {
    string requestUri = @$"{heroName}/details";
    return await _httpClient.GetStringAsync(requestUri);
  }
}

